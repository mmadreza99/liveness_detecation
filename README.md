# ๐ง Liveness Detection System

## ููุฏูู

ุงู ูพุฑูฺู ฺฉ ุณุณุชู ุงุญุฑุงุฒ ููุช ฺูุฑู ุจุง **ุชุดุฎุต ุฒูุฏูโุจูุฏู (Liveness Detection)** ู **ููุงุณูโ ฺูุฑู ุจุง ุชุตูุฑ ูพุงุณูพูุฑุช** ุงุณุช.
ุณุณุชู ุจุง ุงุณุชูุงุฏู ุงุฒ **MediaPipeุ OpenCVุ ู Django** ุณุงุฎุชู ุดุฏู ู ุงุฒ ฺูุฏู ฺุงูุด (ูพูฺฉ ุฒุฏูุ ฺุฑุฎุด ุณุฑุ ุจุงูุง ุจุฑุฏู ุงุจุฑู ุง ุชุฑฺฉุจ ุขูโูุง) ุจุฑุง ุงุทููุงู ุงุฒ ุฒูุฏู ุจูุฏู ฺฉุงุฑุจุฑ ุงุณุชูุงุฏู ูโฺฉูุฏ.

---

## ูฺฺฏโูุง

โ ูพุดุชุจุงู ุงุฒ **ฺุงูุดโูุง ุชุฑฺฉุจ** (ูุซูุงู ูพูฺฉ ุฒุฏู ููโุฒูุงู ุจุง ฺุฑุฎุด ุณุฑ)
โ ุฐุฎุฑูโ ุฎูุฏฺฉุงุฑ **ุชุตุงูุฑ ูพุฑุฏุงุฒุดโุดุฏู ุฏุฑ ูพูุดูโ ุงุฎุชุตุงุต ุจุฑุง ูุฑ ฺฉุงุฑุจุฑ**
โ ููุงุด **ูุถุนุช ุฒูุฏูโุจูุฏู ุฏุฑ ูุญุธู** ุฏุฑ ุตูุญูโ HTML
โ ุงุณุชูุงุฏู ุงุฒ **MediaPipe FaceMesh** ุจุฑุง ุชุญูู ฺูุฑู
โ ููุงุณูโ **ุชุตูุฑ ูพุงุณูพูุฑุช ุจุง ูุฑู ุฒูุฏู ุฑูุจูโุฑู**
โ ุงุฌุฑุง ฺฉุงููุงู ุฏุฑููโุญุงูุธูโุง ุจุฏูู ูุงุฒ ุจู ุฐุฎุฑู ูุงูโูุง ุญุณุงุณ

---

## ุณุงุฎุชุงุฑ ูพุฑูฺู

```
project/
โโโ main/
โ   โโโ views.py               # ููุทู ุชุดุฎุต ุฒูุฏู ุจูุฏู ู ุชุทุจู ฺูุฑู
โ   โโโ templates/
โ       โโโ test_liveness.html # ุฑุงุจุท ฺฉุงุฑุจุฑ ุชุณุช ูุงูููุณ
โโโ README.md
```

---

## ๐งฉ ุณุงุฎุชุงุฑ ฺุงูุดโูุง

ุฏุฑ ูุงู `views.py`ุ ูุฌููุนูโุง ุงุฒ ฺุงูุดโูุง ุชุนุฑู ุดุฏูโุงูุฏ:

```python
COMBO_CHALLENGES = [
    {"instruction": "ุณุฑ ุฎูุฏ ุฑุง ุจู ฺูพ ู ุฑุงุณุช ุจฺุฑุฎุงูุฏ", "type": ["head_turn"], "thresholds": [25.0]},
    {"instruction": "ฺูุฏ ุจุงุฑ ูพูฺฉ ุจุฒูุฏ", "type": ["blink"], "thresholds": [3]},
    {"instruction": "ุงุจุฑููุง ุฎูุฏ ุฑุง ุจุงูุง ุจุจุฑุฏ", "type": ["raise_eyebrows"], "thresholds": [0.02]},
    {"instruction": "ุฏุฑ ุญุงู ฺฉู ุณุฑุช ุฑุง ุจู ฺูพ ู ุฑุงุณุช ูโฺุฑุฎุงู ฺูุฏ ุจุงุฑ ูพูฺฉ ุจุฒู", "type": ["head_turn","blink"], "thresholds": [25.0,3]},
    {"instruction": "ุฏุฑ ุญุงู ฺฉู ุณุฑุช ุฑุง ุจู ฺูพ ู ุฑุงุณุช ูโฺุฑุฎุงู ุงุจุฑููุง ุฎูุฏ ุฑุง ุจุงูุง ,ูพุงู ุจุจุฑุฏ", "type": ["head_turn","raise_eyebrows"], "thresholds": [25.0,0.02]},
    {"instruction": "ุฏุฑ ุญุงู ฺฉู ุงุจุฑููุง ุฎูุฏ ุฑุง ุจุงูุง ,ูพุงู ุจุจุฑุฏ, ฺูุฏ ุจุงุฑ ูพูฺฉ ุจุฒูุฏ", "type": ["blink","raise_eyebrows"], "thresholds": [3,0.02]},
]
```

ูุฑ ุฏุฑุฎูุงุณุช ุฌุฏุฏ ฺฉ **nonce** ููุญุตุฑุจูโูุฑุฏ ุฏุงุฑุฏ ู ุฏุงุฏูโูุง ูุฑุจูุท ุจู ุขู ุฏุฑ Cache ุฐุฎุฑู ูโุดูุฏ.

---

## โ๏ธ ููุทู ุงุตู

### ูุณุฑูุง

| ูุณุฑ                           | ุชูุถุญ                                        |
| ------------------------------ | -------------------------------------------- |
| `/check_frame/`                | ุฏุฑุงูุช ูุฑูโูุง ุชุตูุฑ ู ูพุฑุฏุงุฒุด ฺุงูุด ูุงูููุณ |
| `/upload_passport_and_verify/` | ููุงุณู ุชุตูุฑ ูพุงุณูพูุฑุช ุจุง ูุฑู ุฑูุจูโุฑู         |
| `/reset_attempts/`             | ุจุงุฒูุดุงู ูุถุนุช ฺุงูุด                          |
| `/liveness_test/`              | ููุงุด ุตูุญู HTML ุจุฑุง ุชุณุช                     |

---

### ุฑููุฏ ุงุฌุฑุง ูุงูููุณ

1. ฺฉุงุฑุจุฑ ุฏฺฉููโ **ุดุฑูุน** ุฑุง ุฏุฑ ูุฑูุฑฺฏุฑ ูโุฒูุฏ.
2. ุงุฒ ุณุฑูุฑุ ฺฉ ุฏุณุชูุฑ ุชุตุงุฏู ุฏุฑุงูุช ูโุดูุฏ (ูุซูุงู "ูพูฺฉ ุจุฒูุฏ").
3. ูุฑูุฑฺฏุฑ ูุฑ ณฐฐ ููโุซุงูู ฺฉ ูุฑู ุงุฒ ูุฏู ูโฺฏุฑุฏ ู ุจู `/check_frame/` ูโูุฑุณุชุฏ.
4. ุณุฑูุฑ ุจุง ุงุณุชูุงุฏู ุงุฒ **MediaPipe** ุญุฑฺฉุงุช ฺูุฑู ุฑุง ุจุฑุฑุณ ูโฺฉูุฏ.
5. ูพุณ ุงุฒ ุญุฏูุฏ ฑฐ ุซุงููุ ูุชุฌูโ ฺุงูุด ุจุฑูโฺฏุฑุฏุฏ:

   * โ ุฒูุฏู ุจูุฏู ุชุฃุฏ ุดุฏู
   * โ๏ธ ฺุงูุด ุงูุฌุงู ูุดุฏู (ุฏูุจุงุฑู ุชูุงุด ฺฉูุฏ)

---

## ๐ผ๏ธ ุฐุฎุฑูโ ุชุตุงูุฑ

ูุฑ ุฏุฑุฎูุงุณุช ฺฉุงุฑุจุฑ ุฏุฑ ูุณุฑ ุฒุฑ ุฐุฎุฑู ูโุดูุฏ:

```
/tmp/liveness_debug/<nonce>/
```

ูุฑ ุชุตูุฑ ุจุง ูุงู ุดุงูู ููุน ูฺฺฏ ู ุดูุงุฑูโ ูุฑู ุฐุฎุฑู ูโุดูุฏุ ูุซู:

```
blink_close_12_0.15.jpg
head_turn__8.jpg
raise_eyebrows-6-0.021.jpg
```

---

## ๐ชช ููุงุณูโ ุชุตูุฑ ูพุงุณูพูุฑุช

ูุณุฑ API: `/upload_passport_and_verify/`

ูุฑุขูุฏ:

1. ฺฉุงุฑุจุฑ ุชุตูุฑ ูพุงุณูพูุฑุช ุฑุง ุจู ุตูุฑุช Base64 ูโูุฑุณุชุฏ.
2. ุงุฒ ุขุฎุฑู ฺุงูุดุ ูุฑู ุฑูุจูโุฑู (front_frame) ุงุฒ ุญุงูุธู ุจุฑุฏุงุดุชู ูโุดูุฏ.
3. ุจุง ุงุณุชูุงุฏู ุงุฒ `face_recognition` ุฏู ฺูุฑู ููุงุณู ูโุดููุฏ.
4. ูุชุฌูโ ููุง ุดุงูู ููุงุฑุฏ ุฒุฑ ุจุฑูโฺฏุฑุฏุฏ:

```json
{
  "match": true,
  "distance": 0.42,
  "threshold": 0.55,
  "confidence": "76.3%",
  "message": "โ Identity verified"
}
```

---

## ๐ป ุฑุงุจุท ฺฉุงุฑุจุฑ (`test_liveness.html`)

ุตูุญูโ HTML ุดุงูู:

* ููุงุด ุฒูุฏูโ ูุฏู ุงุฒ ุฏูุฑุจู
* ุฏุณุชูุฑ ฺุงูุด ุฏุฑ ุจุงูุง ุชุตูุฑ
* ุดูุงุฑุด ูุนฺฉูุณ (ฑฐ ุซุงูู)
* ูุถุนุช ูุนู ู ูุชุฌูโ ููุง
* ุฏฺฉููโูุง ุดุฑูุน ู ุจุงุฒูุดุงู

ุฌุงูุงุงุณฺฉุฑูพุช ุตูุญู ูุธููโ:

* ูุนุงูโุณุงุฒ ุฏูุฑุจู
* ุงุฑุณุงู ูุฑูโูุง ุจู `/check_frame/`
* ุจูโุฑูุฒุฑุณุงู ุฑุงุจุท ฺฉุงุฑุจุฑ ุฏุฑ ุฒูุงู ูุงูุน
  ุฑุง ุจุฑ ุนูุฏู ุฏุงุฑุฏ.

---

## ๐ฆ ูพุดโูุงุฒูุง

ุจุฑุง ุงุฌุฑุง ูพุฑูฺู ุจู ฺฉุชุงุจุฎุงููโูุง ุฒุฑ ูุงุฒ ุฏุงุฑุฏ (ูุงุจู ูุตุจ ุขููุงู):

```
opencv-python
mediapipe
face_recognition
numpy
django
```

---

## ๐ ุงุฌุฑุง

1. ุงุฌุฑุง ุณุฑูุฑ Django:

   ```bash
   python manage.py runserver
   ```
2. ุจุงุฒ ฺฉุฑุฏู ุขุฏุฑุณ:

   ```
   http://127.0.0.1:8000/liveness_test/
   ```
